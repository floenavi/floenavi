<h1 id="release-notes-for-v3.1">Release-Notes for v3.1</h1>
<ul>
<li>The delivery of v3.1 package contains the following files
<ul>
<li><code>FloeNavi-App-3.1.apk</code>: Full version of the app</li>
<li><code>FloeNavi-SyncServer-Patch-2.1.0.zip</code>: Incremental update for the SyncServer</li>
</ul></li>
<li>The upgrade of the SyncServer requires an installed <strong>SyncServer v1</strong>.</li>
</ul>
<h2 id="new-features-in-v3.1-since-v3">New Features in v3.1 since v3</h2>
<h3 id="syncserver">SyncServer</h3>
<ul>
<li>Export Device Operations
<ul>
<li>Support for Flag: EXPORTED, PENDING, EXCLUDED</li>
</ul></li>
<li>Issues resolved
<ul>
<li>CSV fields filtered for <strong>newline</strong> characters</li>
<li>Device Operations only exported once</li>
<li>CSV timestamp adjusted to reflect non-standard datetime format requirements</li>
</ul></li>
</ul>
<h3 id="floenavi-app">FloeNavi-App</h3>
<ul>
<li>Issues resolved
<ul>
<li>Removing Origin-Station or X-Axis-Station no longer stops the App</li>
</ul></li>
</ul>
<h2 id="new-features-in-v3-since-v1">New Features in v3 since v1</h2>
<h3 id="syncserver-1">SyncServer</h3>
<ul>
<li>Synchronisation
<ul>
<li>Logistical Installations</li>
<li>Grid Configuration</li>
</ul></li>
<li>Sending Configuration Information to the app
<ul>
<li>Admin PIN</li>
<li>Security PIN</li>
<li>Mothership MMSI</li>
</ul></li>
<li>Providing overlay map image and configuration for the app
<ul>
<li>Upload folder on SyncServer host</li>
</ul></li>
<li>Support for replacing the grid with a new grid from the app</li>
</ul>
<h3 id="floenavi-app-1">FloeNavi-App</h3>
<ul>
<li>Grid Configuration
<ul>
<li>Grid with Origin and X-Axis</li>
<li>Adding and removing additional base stations</li>
</ul></li>
<li>Grid View
<ul>
<li>Showing Logistical Installations</li>
<li>Displaying Waypoints</li>
<li>Tracking of Mobile Stations</li>
<li>Showing Base Stations (origin, x-axis and additional)</li>
<li>Shows Mothership</li>
<li>Zoom and Pan</li>
<li>Map image overlay</li>
<li>Waypoints, Logistical Installations and Base Stations can be hidden</li>
<li>Popup shows name, lat/lon and x/y of each icon</li>
</ul></li>
<li>Creation/Logging
<ul>
<li>Logistical Installations</li>
<li>Device Operations with joined Logistical Installations</li>
<li>Waypoints</li>
</ul></li>
<li>Synchronisation
<ul>
<li>Logistical Installations</li>
<li>Device Information and Operations</li>
<li>Grid Origin and X-Axis Station</li>
<li>App Configuration (security configuration and mothership mmsi)</li>
</ul></li>
<li>Map support
<ul>
<li>Download of map from the SyncServer</li>
<li>Rotation and Scaling</li>
<li>Tracking map using origin and x-axis station</li>
</ul></li>
</ul>
<h2 id="detailed-feature-description">Detailed Feature Description</h2>
<h3 id="setting-up-admin-and-security-pin">Setting up Admin and Security PIN</h3>
<p>The Admin View and Grid Deletion View is protected by two different 4-digit PIN codes. The codes are configured on the SyncServer. Upon syncing with the SyncServer, the PIN codes are updated in the FloeNavi app.</p>
<p>The example <code>application.yaml</code> is provided in the <a href="https://github.com/floenavi/floenavi/blob/v3_1/UPGRADE.md">upgrade instructions</a> and in the FloeNavi-Patch archive <code>etc</code>-folder.</p>
<p><strong>Note:</strong> - The initial PIN configured on the FloeNavi app is 0000.</p>
<h3 id="map-support-v3">Map support (v3)</h3>
<p>Displaying a map image in the app requires two files to be stored in a admin-defined directory on the SyncServer host. The directory used for providing those files is configured in the <code>application.yaml</code> file with the keyword <code>maps</code></p>
<p>The example <code>application.yaml</code> is provided in the <a href="https://github.com/floenavi/floenavi/blob/v3_1/UPGRADE.md">upgrade instructions</a> and in the FloeNavi-Patch archive <code>etc</code>-folder.</p>
<h4 id="the-map-image-file-map.jpg">1. The map image file <code>map.jpg</code></h4>
<ul>
<li>This must be a standard JPEG file. The app was tested with a jpg of size 3353x1731 pixel and 4MB. Images with 12Mpx (4000x3000) or higher should also be possible.</li>
<li>The position of the origin and x-axis station need to be manually locatable on the image.</li>
</ul>
<figure>
<img src="https://github.com/floenavi/floenavi/raw/v3_1/map/map.jpg" alt="Example Map" /><figcaption>Example Map</figcaption>
</figure>
<p>The origin stations is AIDAperla (red dot at Steinwerder Quay, right of center), the x-axis station is Europa2 (red dot at hamburg cruise center, center and top border).</p>
<h4 id="the-image-configuration-file-map.info">2. The image configuration file <code>map.info</code></h4>
<ul>
<li>The pixel coordinates of the two stations need to be specified</li>
</ul>
<p>Example content of the file:</p>
<pre><code>origin 2300 681
x-axis 1774 201</code></pre>
<ul>
<li>origin is at x=2300, y=681</li>
<li>x-axis is at x=1774, y=201</li>
</ul>
<p>The position <code>x=0</code>, <code>y=0</code> is the top-left corner of the image</p>
<h4 id="disabling-the-map-image">3. Disabling the map image</h4>
<ul>
<li>Remove the files from the map directory on the SyncServer</li>
<li>Perform a sync (download) from the SyncServer</li>
</ul>
<p>If there is no image in the map directory on the SyncServer, the map image on the app will be deleted.</p>
<figure>
<img src="https://github.com/floenavi/floenavi/raw/v3_1/map/map_screenshot.jpg" alt="Example Screenshot" /><figcaption>Example Screenshot</figcaption>
</figure>
<h3 id="grid-deletion-v3">Grid Deletion (v3)</h3>
<p>If there is a grid configured on the SyncServer, and the grid on the app has been deleted with the security pin and a new grid has been initialised, the SyncServer must be prepared to receive the new grid from the app.</p>
<p>A specific url has to be called on the server and the admin token has to be provided.</p>
<p>The following <code>curl</code> command can be used to reset the grid on the SyncServer:</p>
<pre><code>curl -X DELETE -H &quot;Authorization:  Bearer &lt;token&gt;&quot; http://192.168.73.23/grid</code></pre>
<p><code>&lt;token&gt;</code> needs to be replaced by the <code>base64</code> encoded <code>adminToken</code> that is specified also in the SyncServer <code>application.yaml</code> file.</p>
<p>The example <code>application.yaml</code> is provided in the <a href="https://github.com/floenavi/floenavi/blob/v3_1/UPGRADE.md">upgrade instructions</a> and in the FloeNavi-Patch archive <code>etc</code>-folder.</p>
<p>The encoded token for the default admin token is <code>MDEyMzQ1Njc4OWFiY2RlZg==</code>.</p>
<h3 id="audit-log-v3.1">Audit log (v3.1)</h3>
<p>The SyncServer will write a message into a dedicated log file every time that elements are received or send.</p>
<p>The log file must be located in a directory on the SyncServer host. The configuration of the log directory is done in the application.yaml file, with the configuration option <code>logging-&gt;file-&gt;path</code>.</p>
<p>The example <code>application.yaml</code> is provided in the <a href="https://github.com/floenavi/floenavi/blob/v3_1/UPGRADE.md">upgrade instructions</a> and in the FloeNavi-Patch archive <code>etc</code>-folder.</p>
<p><strong>Note:</strong> - On Windows, the backslashes  in the windows directory name need to be escaped as \\ when adding them to the configuration file. - <code>C:\FloeNavi\Logs</code> needs to be written as <code>C:\\FloeNavi\\Logs</code></p>
<h3 id="syncserver-export-flags-v3.1">SyncServer export flags (v3.1)</h3>
<p>To support the requirement of blocking device operations from export to the DSHIP proxy system, the database table managing the device operations supports now an additional field: <code>export_status</code> in table <code>operation</code>.</p>
<p>The allowed values for this field are: - <code>PENDING</code>: The device operation was synced from the tablet and is ready for export - <code>EXCLUDED</code>: This device operation will not be exported - <code>EXPORTED</code>: The device operation was retrieved by the DSHIP proxy and will not be exported again.</p>
<h2 id="known-issues">Known issues</h2>
<h3 id="app">App</h3>
<ul>
<li><del>Removing origin or x-axis base station not working</del> (fixed in v3.1)</li>
<li>Number of synced elements not shown in App Sync View</li>
<li>Additional grid base stations are not synced between tablets</li>
</ul>
<h3 id="syncserver-2">SyncServer</h3>
<ul>
<li>No support for deleting device information</li>
<li><del>No support for tagging device operations “do not export” tag</del> (fixed in v3.1)</li>
<li><del>No extended logging of synchronisation elements</del> (fixed in v3.1)</li>
<li>No synchronisation of additional grid base stations</li>
</ul>
